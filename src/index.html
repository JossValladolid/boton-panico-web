<!-- #1 -->
<!DOCTYPE html>
<html>
<head>
    <title>Enviar Formulario como JSON</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form id="myForm" class="contenedor">
        <div class="contenedor-grid">
            <label for="codigoEstudiante" class="titulo">Código de estudiante:</label>
            <input placeholder="Obligatorio" type="text" id="codigoEstudiante" name="codigoEstudiante" class="cuadro-texto">
            <span id="errorCodigo" style="color: #800000;"></span>
        </div>
        <div class="contenedor-grid">
            <label for="nombre" class="titulo">Nombre:</label>
            <input placeholder="Opcional" id="nombre" name="nombre" class="cuadro-texto">
        </div>
        <div class="contenedor-grid">
            <label for="descripcion" class="titulo">Descripción:</label>
            <textarea placeholder="Obligatorio" type="text" id="descripcion" name="descripcion" class="area-texto" rows="5" cols="60"></textarea>
            <span id="errorDescripcion" style="color: #800000;"></span>
        </div>
        <div class="contenedor-envio">
            <button type="submit" class="input-circular">Enviar</button>
            <span id="exitoEnvio" style="color: #3957a5;"></span>
        </div>
    </form>

    <script>
        function limpiarMensajeExito() {
            exitoEnvioSpan.textContent = '';
        }
        
        function limpiarMensajeErrorCodigo() {
            errorCodigoSpan.textContent = '';
        }

        function limpiarMensajeErrorDescripcion() {
            errorDescripcionSpan.textContent = '';
        }

        const form = document.getElementById('myForm');
        const codigoEstudianteInput = document.getElementById('codigoEstudiante');
        const errorCodigoSpan = document.getElementById('errorCodigo');
        const descripcionInput = document.getElementById('descripcion');
        const nombreInput = document.getElementById('nombre');
        const errorDescripcionSpan = document.getElementById('errorDescripcion');
        const exitoEnvioSpan = document.getElementById('exitoEnvio');

        codigoEstudianteInput.addEventListener('focus', limpiarMensajeExito);
        nombreInput.addEventListener('focus', limpiarMensajeExito);
        descripcionInput.addEventListener('focus', limpiarMensajeExito); 

        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Evita el envío tradicional del formulario

            const codigoEstudianteValor = codigoEstudianteInput.value.trim();
            const nombreValor = document.getElementById('nombre').value;
            const descripcionValor = descripcionInput.value.trim();

            let isValid = true;

            // Validar código de estudiante
            if (codigoEstudianteValor.length !== 9 || !/^\d+$/.test(codigoEstudianteValor)) {
                errorCodigoSpan.textContent = 'El código de estudiante debe tener exactamente 9 dígitos numéricos.';
                isValid = false;
            } else {
                errorCodigoSpan.textContent = '';
            }

            // Validar descripción (no vacía)
            if (descripcionValor === '') {
                errorDescripcionSpan.textContent = 'La descripción no puede estar vacía.';
                isValid = false;
            } else {
                errorDescripcionSpan.textContent = '';
            }

            // Si todos los campos son válidos, proceder con el envío
            if (isValid) {
                const formData = {
                    codigoEstudiante: codigoEstudianteValor,
                    nombre: nombreValor,
                    descripcion: descripcionValor
                };

                const jsonData = JSON.stringify(formData);
                console.log('Datos JSON a enviar:', jsonData);

                fetch('http://localhost:8000/tasks/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: jsonData
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Respuesta del servidor:', data);
                    exitoEnvioSpan.textContent = 'Su reporte ha sido recibido';
                    errorCodigoSpan.textContent = '';
                    errorDescripcionSpan.textContent = '';
                    document.getElementById('codigoEstudiante').value = '';
                    document.getElementById('nombre').value = '';
                    document.getElementById('descripcion').value = '';
                    // Aquí puedes manejar la respuesta del servidor
                })
                .catch(error => {
                    console.error('Error al enviar la petición:', error);
                    // Aquí puedes manejar los errores de la petición
                });
            }
            else {
                limpiarMensajeExito();
            }
        });
        descripcionInput.addEventListener('focus', limpiarMensajeErrorDescripcion);
        codigoEstudianteInput.addEventListener('focus', limpiarMensajeErrorCodigo);
    </script>
</body>
</html>